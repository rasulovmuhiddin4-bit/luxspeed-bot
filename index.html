<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxspeed - Telegram Taksibot</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #0088cc;
            --secondary: #00cc88;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --gray: #6c757d;
            --danger: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }
        
        .container {
            max-width: 100%;
            background: white;
            min-height: 100vh;
            position: relative;
        }
        
        .header {
            background: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .driver-header {
            background: linear-gradient(135deg, #ffcc00, #ff9900);
            color: #333;
        }
        
        .logo {
            font-size: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .content {
            padding: 20px;
            padding-bottom: 80px;
        }
        
        .welcome {
            text-align: center;
            margin-bottom: 20px;
            color: var(--dark);
        }
        
        .welcome h2 {
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .driver-welcome h2 {
            color: #ff9900;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--dark);
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 136, 204, 0.2);
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 0;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-driver {
            background: linear-gradient(135deg, #ffcc00, #ff9900);
            color: #333;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-info {
            background: var(--primary);
            color: white;
        }
        
        .map-container {
            height: 200px;
            background: #e9ecef;
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--gray);
            position: relative;
        }
        
        .driver-info {
            background: var(--light);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .driver-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
        }
        
        .customer-info {
            background: #e8f5e9;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid var(--success);
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            font-weight: 600;
        }
        
        .driver-tab.active {
            border-bottom: 3px solid #ff9900;
            color: #ff9900;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            max-width: 90%;
        }
        
        .language-selector {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .language-option {
            flex: 1;
            text-align: center;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
        }
        
        .language-option.active {
            border-color: var(--primary);
            background: rgba(0, 136, 204, 0.1);
        }
        
        .payment-methods {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .payment-method {
            flex: 1;
            text-align: center;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
        }
        
        .payment-method.active {
            border-color: var(--primary);
            background: rgba(0, 136, 204, 0.1);
        }
        
        .admin-alert {
            background: #ffebee;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid var(--danger);
            text-align: center;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .loading i {
            font-size: 40px;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .history-item {
            background: var(--light);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid var(--primary);
        }
        
        .order-item {
            background: var(--light);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #ff9900;
        }
        
        .admin-contact-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .admin-contact-card h3 {
            margin-bottom: 10px;
            font-size: 1.5em;
        }
        
        .admin-contact-card p {
            margin-bottom: 15px;
            opacity: 0.9;
        }
        
        .back-to-main {
            background: var(--gray);
            color: white;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- Yuklash sahifasi -->
    <div class="container" id="loadingContainer">
        <div class="content">
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i>
                <h3 id="loadingText">Yuklanmoqda...</h3>
            </div>
        </div>
    </div>

    <!-- Mijoz interfeysi -->
    <div class="container" id="customerContainer" style="display: none;">
        <div class="header">
            <div class="logo">
                <i class="fas fa-taxi"></i>
                Luxspeed Mijoz
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="order">Taksi chaqirish</div>
            <div class="tab" data-tab="history">Tarix</div>
            <div class="tab" data-tab="admin">Admin bilan aloqa</div>
            <div class="tab" data-tab="profile">Profil</div>
        </div>
        
        <div class="content">
            <!-- Taksi chaqirish -->
            <div class="tab-content active" id="order-tab">
                <div class="welcome">
                    <h2 id="customerWelcome">Taksi chaqirish</h2>
                    <p id="customerSubtitle">Quyidagi ma'lumotlarni to'ldiring</p>
                </div>
                
                <div class="form-group">
                    <label id="nameLabel">Ismingiz</label>
                    <input type="text" id="customerName" class="form-control" placeholder="Ismingizni kiriting">
                </div>
                
                <div class="form-group">
                    <label id="phoneLabel">Telefon raqamingiz</label>
                    <input type="tel" id="customerPhone" class="form-control" placeholder="+998 XX XXX XX XX">
                </div>
                
                <div class="form-group">
                    <label id="fromLabel">Qayerdan</label>
                    <input type="text" id="fromLocation" class="form-control" placeholder="Manzilingiz">
                </div>
                
                <div class="form-group">
                    <label id="toLabel">Qayerga</label>
                    <input type="text" id="toLocation" class="form-control" placeholder="Yo'nalishingiz">
                </div>
                
                <div class="payment-methods">
                    <div class="payment-method active" data-method="cash">
                        <i class="fas fa-money-bill-wave"></i>
                        <p id="cashLabel">Naqd pul</p>
                    </div>
                    <div class="payment-method" data-method="card">
                        <i class="fas fa-credit-card"></i>
                        <p id="cardLabel">Karta</p>
                    </div>
                </div>
                
                <div class="map-container">
                    <i class="fas fa-map-marker-alt" style="font-size: 40px; color: var(--primary);"></i>
                    <p id="mapText">Joylashuv xaritasi</p>
                </div>
                
                <button class="btn btn-success" id="orderBtn">
                    <i class="fas fa-taxi"></i>
                    <span id="orderText">Taksi chaqirish</span>
                </button>
            </div>
            
            <!-- Tarix -->
            <div class="tab-content" id="history-tab">
                <div class="welcome">
                    <h2 id="historyTitle">Buyurtmalar tarixi</h2>
                    <p id="historySubtitle">Oldingi safarlaringiz</p>
                </div>
                <div id="historyList">
                    <!-- Tarix bu yerda ko'rsatiladi -->
                </div>
            </div>
            
            <!-- Admin bilan aloqa -->
            <div class="tab-content" id="admin-tab">
                <div class="welcome">
                    <h2 id="adminTitle">Admin bilan aloqa</h2>
                    <p id="adminSubtitle">Savol va takliflaringiz bo'lsa</p>
                </div>
                
                <div class="admin-contact-card">
                    <i class="fas fa-headset" style="font-size: 50px; margin-bottom: 15px;"></i>
                    <h3>@Aloqa_admin1985</h3>
                    <p>Admin bilan bog'lanish uchun quyidagi tugmani bosing</p>
                    <button class="btn btn-info" id="contactAdminBtn">
                        <i class="fab fa-telegram"></i>
                        <span id="contactAdminText">Admin bilan bog'lanish</span>
                    </button>
                </div>
                
                <div class="admin-alert">
                    <p><i class="fas fa-info-circle"></i> Savol, taklif yoki shikoyatlaringiz bo'lsa, admin bilan bog'lanishingiz mumkin</p>
                </div>
            </div>
            
            <!-- Profil -->
            <div class="tab-content" id="profile-tab">
                <div class="welcome">
                    <h2 id="profileTitle">Profil</h2>
                    <p id="profileSubtitle">Shaxsiy ma'lumotlaringiz</p>
                </div>
                
                <div class="driver-info">
                    <div class="driver-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <h4 id="userName">Foydalanuvchi</h4>
                        <p id="userPhone">Telefon: -</p>
                    </div>
                </div>
                
                <div class="language-selector">
                    <div class="language-option active" data-lang="uz">
                        O'zbekcha
                    </div>
                    <div class="language-option" data-lang="ru">
                        Русский
                    </div>
                </div>
                
                <button class="btn btn-primary" id="supportBtn">
                    <i class="fas fa-headset"></i>
                    <span id="supportText">Qo'llab-quvvatlash</span>
                </button>
                
                <button class="btn btn-primary back-to-main" id="backToMainBtn">
                    <i class="fas fa-home"></i>
                    <span id="backToMainText">Asosiy menyuga qaytish</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Haydovchi interfeysi -->
    <div class="container" id="driverContainer" style="display: none;">
        <div class="header driver-header">
            <div class="logo">
                <i class="fas fa-taxi"></i>
                Luxspeed Haydovchi
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab driver-tab active" data-tab="driver-main">Asosiy</div>
            <div class="tab driver-tab" data-tab="driver-orders">Buyurtmalar</div>
            <div class="tab driver-tab" data-tab="driver-admin">Admin bilan aloqa</div>
            <div class="tab driver-tab" data-tab="driver-profile">Profil</div>
        </div>
        
        <div class="content">
            <!-- Asosiy -->
            <div class="tab-content active" id="driver-main-tab">
                <div class="welcome driver-welcome">
                    <h2 id="driverWelcome">Haydovchi paneli</h2>
                    <p id="driverSubtitle">Ishga tayyormisiz?</p>
                </div>
                
                <div class="driver-info">
                    <div class="driver-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <h4 id="driverName">Haydovchi</h4>
                        <p id="driverCar">Mashina: -</p>
                        <p id="driverStatus">Holat: Faol</p>
                    </div>
                </div>
                
                <div class="map-container">
                    <i class="fas fa-map-marker-alt" style="font-size: 40px; color: #ff9900;"></i>
                    <p id="driverMapText">Joylashuv xaritasi</p>
                </div>
                
                <button class="btn btn-driver" id="findCustomerBtn">
                    <i class="fas fa-user-plus"></i>
                    <span id="findCustomerText">Mijoz qidirish</span>
                </button>
            </div>
            
            <!-- Buyurtmalar -->
            <div class="tab-content" id="driver-orders-tab">
                <div class="welcome driver-welcome">
                    <h2 id="ordersTitle">Buyurtmalar</h2>
                    <p id="ordersSubtitle">Bajarilgan buyurtmalar</p>
                </div>
                <div id="ordersList">
                    <!-- Buyurtmalar bu yerda ko'rsatiladi -->
                </div>
            </div>
            
            <!-- Admin bilan aloqa -->
            <div class="tab-content" id="driver-admin-tab">
                <div class="welcome driver-welcome">
                    <h2 id="driverAdminTitle">Admin bilan aloqa</h2>
                    <p id="driverAdminSubtitle">Savol va takliflaringiz bo'lsa</p>
                </div>
                
                <div class="admin-contact-card">
                    <i class="fas fa-headset" style="font-size: 50px; margin-bottom: 15px;"></i>
                    <h3>@Aloqa_admin1985</h3>
                    <p>Admin bilan bog'lanish uchun quyidagi tugmani bosing</p>
                    <button class="btn btn-info" id="driverContactAdminBtn">
                        <i class="fab fa-telegram"></i>
                        <span id="driverContactAdminText">Admin bilan bog'lanish</span>
                    </button>
                </div>
                
                <div class="admin-alert">
                    <p><i class="fas fa-info-circle"></i> Savol, taklif yoki shikoyatlaringiz bo'lsa, admin bilan bog'lanishingiz mumkin</p>
                </div>
            </div>
            
            <!-- Profil -->
            <div class="tab-content" id="driver-profile-tab">
                <div class="welcome driver-welcome">
                    <h2 id="driverProfileTitle">Profil</h2>
                    <p id="driverProfileSubtitle">Shaxsiy ma'lumotlaringiz</p>
                </div>
                
                <div class="driver-info">
                    <div class="driver-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <h4 id="profileDriverName">Haydovchi</h4>
                        <p id="profileDriverPhone">Telefon: -</p>
                        <p id="profileDriverCar">Mashina: -</p>
                    </div>
                </div>
                
                <div class="language-selector">
                    <div class="language-option active" data-lang="uz">
                        O'zbekcha
                    </div>
                    <div class="language-option" data-lang="ru">
                        Русский
                    </div>
                </div>
                
                <button class="btn btn-driver" id="driverSupportBtn">
                    <i class="fas fa-headset"></i>
                    <span id="driverSupportText">Qo'llab-quvvatlash</span>
                </button>
                
                <button class="btn btn-driver back-to-main" id="driverBackToMainBtn">
                    <i class="fas fa-home"></i>
                    <span id="driverBackToMainText">Asosiy menyuga qaytish</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Telegram WebApp
        const tg = window.Telegram.WebApp;
        
        // Foydalanuvchi ma'lumotlari
        let userData = {
            id: null,
            role: null,
            language: 'uz'
        };
        
        // Til matnlari
        const translations = {
            uz: {
                loading: "Yuklanmoqda...",
                customerWelcome: "Taksi chaqirish",
                customerSubtitle: "Quyidagi ma'lumotlarni to'ldiring",
                nameLabel: "Ismingiz",
                phoneLabel: "Telefon raqamingiz",
                fromLabel: "Qayerdan",
                toLabel: "Qayerga",
                cashLabel: "Naqd pul",
                cardLabel: "Karta",
                mapText: "Joylashuv xaritasi",
                orderText: "Taksi chaqirish",
                adminTitle: "Admin bilan aloqa",
                adminSubtitle: "Savol va takliflaringiz bo'lsa",
                contactAdminText: "Admin bilan bog'lanish",
                historyTitle: "Buyurtmalar tarixi",
                historySubtitle: "Oldingi safarlaringiz",
                profileTitle: "Profil",
                profileSubtitle: "Shaxsiy ma'lumotlaringiz",
                supportText: "Qo'llab-quvvatlash",
                backToMainText: "Asosiy menyuga qaytish",
                driverWelcome: "Haydovchi paneli",
                driverSubtitle: "Ishga tayyormisiz?",
                findCustomerText: "Mijoz qidirish",
                driverAdminTitle: "Admin bilan aloqa",
                driverAdminSubtitle: "Savol va takliflaringiz bo'lsa",
                driverContactAdminText: "Admin bilan bog'lanish",
                ordersTitle: "Buyurtmalar",
                ordersSubtitle: "Bajarilgan buyurtmalar",
                driverProfileTitle: "Profil",
                driverProfileSubtitle: "Shaxsiy ma'lumotlaringiz",
                driverSupportText: "Qo'llab-quvvatlash",
                driverBackToMainText: "Asosiy menyuga qaytish"
            },
            ru: {
                loading: "Загрузка...",
                customerWelcome: "Вызов такси",
                customerSubtitle: "Заполните следующие данные",
                nameLabel: "Ваше имя",
                phoneLabel: "Ваш телефон",
                fromLabel: "Откуда",
                toLabel: "Куда",
                cashLabel: "Наличные",
                cardLabel: "Карта",
                mapText: "Карта местоположения",
                orderText: "Вызвать такси",
                adminTitle: "Связь с админом",
                adminSubtitle: "Если у вас есть вопросы или предложения",
                contactAdminText: "Связаться с админом",
                historyTitle: "История заказов",
                historySubtitle: "Ваши предыдущие поездки",
                profileTitle: "Профиль",
                profileSubtitle: "Ваши личные данные",
                supportText: "Поддержка",
                backToMainText: "Вернуться в главное меню",
                driverWelcome: "Панель водителя",
                driverSubtitle: "Готовы к работе?",
                findCustomerText: "Поиск клиентов",
                driverAdminTitle: "Связь с админом",
                driverAdminSubtitle: "Если у вас есть вопросы или предложения",
                driverContactAdminText: "Связаться с админом",
                ordersTitle: "Заказы",
                ordersSubtitle: "Выполненные заказы",
                driverProfileTitle: "Профиль",
                driverProfileSubtitle: "Ваши личные данные",
                driverSupportText: "Поддержка",
                driverBackToMainText: "Вернуться в главное меню"
            }
        };

        // Dastur ishga tushganda
        document.addEventListener('DOMContentLoaded', function() {
            // Telegram WebApp mavjudligini tekshirish
            if (window.Telegram && window.Telegram.WebApp) {
                tg.ready();
                tg.expand();
                
                // URL parametrlarini o'qish
                const urlParams = new URLSearchParams(window.location.search);
                userData.id = urlParams.get('user_id') || tg.initDataUnsafe.user?.id;
                userData.role = urlParams.get('role') || 'customer';
                userData.language = urlParams.get('lang') || 'uz';
            } else {
                // Telegram WebApp mavjud bo'lmasa, test rejimida ishlash
                userData.id = 'test_user_' + Math.floor(Math.random() * 1000);
                userData.role = 'customer';
                userData.language = 'uz';
            }
            
            // Tilni sozlash
            setupLanguage();
            
            // Interfeysni yuklash
            loadInterface();
            
            // Event listenerlarni sozlash
            setupEventListeners();
        });

        // Tilni sozlash
        function setupLanguage() {
            applyTranslations();
        }

        // Tarjimalarni qo'llash
        function applyTranslations() {
            const lang = userData.language;
            const texts = translations[lang];
            
            for (const [key, value] of Object.entries(texts)) {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = value;
                }
            }
        }

        // Interfeysni yuklash
        function loadInterface() {
            const loadingContainer = document.getElementById('loadingContainer');
            const customerContainer = document.getElementById('customerContainer');
            const driverContainer = document.getElementById('driverContainer');
            
            // Yuklashni yashirish
            setTimeout(() => {
                loadingContainer.style.display = 'none';
                
                // Rolga qarab interfeysni ko'rsatish
                if (userData.role === 'customer') {
                    customerContainer.style.display = 'block';
                    setupCustomerInterface();
                } else if (userData.role === 'driver') {
                    driverContainer.style.display = 'block';
                    setupDriverInterface();
                } else {
                    // Agar rol aniqlanmagan bo'lsa, mijoz interfeysini ko'rsatish
                    customerContainer.style.display = 'block';
                    setupCustomerInterface();
                }
            }, 1500);
        }

        // Mijoz interfeysini sozlash
        function setupCustomerInterface() {
            // Foydalanuvchi ma'lumotlarini to'ldirish
            if (window.Telegram && window.Telegram.WebApp) {
                const user = tg.initDataUnsafe.user;
                if (user) {
                    document.getElementById('userName').textContent = user.first_name || 'Foydalanuvchi';
                    document.getElementById('customerName').value = user.first_name || '';
                    
                    if (user.username) {
                        document.getElementById('userPhone').textContent = `Telegram: @${user.username}`;
                    }
                }
            }
            
            // Tarixni yuklash
            loadHistory();
        }

        // Haydovchi interfeysini sozlash
        function setupDriverInterface() {
            // Haydovchi ma'lumotlarini to'ldirish
            if (window.Telegram && window.Telegram.WebApp) {
                const user = tg.initDataUnsafe.user;
                if (user) {
                    document.getElementById('driverName').textContent = user.first_name || 'Haydovchi';
                    document.getElementById('profileDriverName').textContent = user.first_name || 'Haydovchi';
                    
                    if (user.username) {
                        document.getElementById('profileDriverPhone').textContent = `Telegram: @${user.username}`;
                    }
                }
            }
            
            // Buyurtmalarni yuklash
            loadOrders();
        }

        // Event listenerlarni sozlash
        function setupEventListeners() {
            // Tab o'zgartirish
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Barcha tab va kontentlarni yopish
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Faol tab va kontentni ko'rsatish
                    this.classList.add('active');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // To'lov usulini tanlash
            document.querySelectorAll('.payment-method').forEach(method => {
                method.addEventListener('click', function() {
                    document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Tilni tanlash
            document.querySelectorAll('.language-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.language-option').forEach(o => o.classList.remove('active'));
                    this.classList.add('active');
                    
                    userData.language = this.getAttribute('data-lang');
                    applyTranslations();
                    showNotification("Til o'zgartirildi");
                });
            });
            
            // Taksi chaqirish
            document.getElementById('orderBtn').addEventListener('click', function() {
                createOrder();
            });
            
            // Mijoz qidirish
            document.getElementById('findCustomerBtn').addEventListener('click', function() {
                findCustomer();
            });
            
            // Admin bilan aloqa
            document.getElementById('contactAdminBtn').addEventListener('click', function() {
                contactAdmin();
            });
            
            document.getElementById('driverContactAdminBtn').addEventListener('click', function() {
                contactAdmin();
            });
            
            // Asosiy menyuga qaytish
            document.getElementById('backToMainBtn').addEventListener('click', function() {
                goToMainMenu();
            });
            
            document.getElementById('driverBackToMainBtn').addEventListener('click', function() {
                goToMainMenu();
            });
        }

        // Buyurtma yaratish
        function createOrder() {
            const name = document.getElementById('customerName').value;
            const phone = document.getElementById('customerPhone').value;
            const from = document.getElementById('fromLocation').value;
            const to = document.getElementById('toLocation').value;
            const paymentMethod = document.querySelector('.payment-method.active').getAttribute('data-method');
            
            if (!name || !phone || !from || !to) {
                showNotification("Iltimos, barcha maydonlarni to'ldiring!");
                return;
            }
            
            showNotification("Buyurtmangiz qabul qilindi! Haydovchi topilmoqda...");
            
            // Telegram botga ma'lumot yuborish
            if (window.Telegram && window.Telegram.WebApp) {
                tg.sendData(JSON.stringify({
                    action: 'create_order',
                    user_id: userData.id,
                    name: name,
                    phone: phone,
                    from: from,
                    to: to,
                    payment_method: paymentMethod,
                    language: userData.language
                }));
            } else {
                // Test rejimi
                console.log('Buyurtma yaratildi:', { name, phone, from, to, paymentMethod });
                addToHistory({ from, to, date: new Date().toLocaleString(), status: 'active' });
            }
        }

        // Mijoz qidirish
        function findCustomer() {
            showNotification("Mijozlar qidirilmoqda...");
            
            // Telegram botga so'rov yuborish
            if (window.Telegram && window.Telegram.WebApp) {
                tg.sendData(JSON.stringify({
                    action: 'find_customer',
                    user_id: userData.id,
                    language: userData.language
                }));
            } else {
                // Test rejimi
                console.log('Mijoz qidirish boshlandi');
                setTimeout(() => {
                    showNotification("Mijoz topildi! Buyurtma bering.");
                }, 2000);
            }
        }

        // Admin bilan aloqa
        function contactAdmin() {
            if (window.Telegram && window.Telegram.WebApp) {
                // Telegram WebApp orqali admin bilan bog'lanish
                tg.sendData(JSON.stringify({
                    action: 'contact_admin',
                    user_id: userData.id
                }));
                
                // Telegram kanaliga yo'naltirish
                tg.openTelegramLink('https://t.me/Aloqa_admin1985');
            } else {
                // Test rejimi
                window.open('https://t.me/Aloqa_admin1985', '_blank');
            }
            
            showNotification("Admin bilan bog'lanilmoqda...");
        }

        // Asosiy menyuga qaytish
        function goToMainMenu() {
            if (window.Telegram && window.Telegram.WebApp) {
                // WebApp ni yopish va botga qaytish
                tg.close();
            } else {
                // Test rejimi
                showNotification("Asosiy menyuga qaytish");
                window.location.href = 'https://t.me/your_bot_username';
            }
        }

        // Xabarnoma ko'rsatish
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Tarixni yuklash
        function loadHistory() {
            const historyList = document.getElementById('historyList');
            if (!historyList) return;
            
            // Test ma'lumotlari
            const testHistory = [
                { from: "Chorsu bozori", to: "Amir Temur maydoni", date: "2023-10-15 14:30", status: "completed" },
                { from: "Toshkent markazi", to: "Havo terminali", date: "2023-10-10 09:15", status: "completed" },
                { from: "Yunusobod", to: "Mirzo Ulug'bek", date: "2023-10-05 18:45", status: "completed" }
            ];
            
            historyList.innerHTML = '';
            
            testHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <h4>${item.from} → ${item.to}</h4>
                    <p>Sana: ${item.date}</p>
                    <p>Holat: ${item.status === 'completed' ? 'Bajarildi' : 'Faol'}</p>
                `;
                historyList.appendChild(historyItem);
            });
        }
        
        // Buyurtmalarni yuklash
        function loadOrders() {
            const ordersList = document.getElementById('ordersList');
            if (!ordersList) return;
            
            // Test ma'lumotlari
            const testOrders = [
                { from: "Chorsu bozori", to: "Amir Temur maydoni", date: "2023-10-15 14:30", price: "15,000 so'm" },
                { from: "Toshkent markazi", to: "Havo terminali", date: "2023-10-10 09:15", price: "25,000 so'm" },
                { from: "Yunusobod", to: "Mirzo Ulug'bek", date: "2023-10-05 18:45", price: "12,000 so'm" }
            ];
            
            ordersList.innerHTML = '';
            
            testOrders.forEach(item => {
                const orderItem = document.createElement('div');
                orderItem.className = 'order-item';
                orderItem.innerHTML = `
                    <h4>${item.from} → ${item.to}</h4>
                    <p>Sana: ${item.date}</p>
                    <p>Narx: ${item.price}</p>
                `;
                ordersList.appendChild(orderItem);
            });
        }
        
        // Tarixga qo'shish
        function addToHistory(order) {
            const historyList = document.getElementById('historyList');
            if (!historyList) return;
            
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            historyItem.innerHTML = `
                <h4>${order.from} → ${order.to}</h4>
                <p>Sana: ${order.date}</p>
                <p>Holat: ${order.status === 'completed' ? 'Bajarildi' : 'Faol'}</p>
            `;
            historyList.prepend(historyItem);
        }

        // Telegram WebApp dan kelgan ma'lumotlarni qayta ishlash
        if (window.Telegram && window.Telegram.WebApp) {
            tg.onEvent('viewportChanged', function() {
                tg.expand();
            });
        }
    </script>
</body>
</html>